<% klass.students_by_last_name.each do |student| %>
  <%= content_tag(:tr) do %>
    <%= td_link_to_student(klass, student) %>
    <%= td_student_average(student, klass_or_lt) %>

    <% collection.each do |lt| %>
      <%= blank_td?(lt) %>

        <% lt.students_chronological_grades(student).each_with_index do |grade, index| %>
          <%= form_for(:grade, url: klass_grade_path(klass, grade), html: {class: "grade-input"}) do |f| %>
            <%= content_tag(:td, class: td_classes(index, "score"), id: "#{grade.id}") do %>
              <%= f.text_field(:score, class: "grade-text-field") %>
              <%= f.hidden_field(:id, :value => grade.id) %>
            <% end %>
            <%= f.submit(nil, class: "hide-submit") %>
          <% end %>
        <% end %>

    <% end %>
  <% end %>
<% end %>
